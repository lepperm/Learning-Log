{%- include favicons.html -%}

{%- if page.tags -%}
  <meta name="keywords" content="Max Lepper, learning log, blog, web development, {{ page.tags | join: ', ' | escape}}"/>
{%- else -%}
  <meta name="keywords" content="Max Lepper, learning log, blog, web development"/>
{%- endif -%}

<!-- The script below handles delivering update notifications from the jekyll-pwa-plugin "sw.update" event -->
<script>
  {% assign latestPost = site.posts.first %}

  function showNotification() {
    if(document.visibilityState === "visible") {
      if(confirm("New content has been posted! Tap OK to check out '{{ latestPost.title }}'")) {
        window.location.href = "{{ site.baseurl }}{{ latestPost.url }}";
      } else {
        window.location.reload(true);
      };
      return;
    }

    let title = "Learning Log";
    let options = {
      body: "New log posted! Check out '{{ latestPost.title }}' on Learning Log!",
      icon: "{{site.baseurl}}/assets/images/favicons/android-chrome-192x192.png",
      vibrate: [200, 100, 200]
    }

    let notification = new Notification(title, options);
    
    notification.onclick = () => {
      notification.close();
      window.parent.focus();
      window.location.href = "{{ site.baseurl }}{{ latestPost.url }}";
    }
  }

  // On new content and enabled notifications, refresh the page and alert the user about the new content
  window.addEventListener("sw.update", function () {
    let permission = Notification.permission;
    if(permission === "granted") {
      showNotification();
    }
  });
</script>